// Configurações iniciais
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- SEÇÃO DE ESTOQUE E EVENTOS ---

model Toy {
  id         Float       @id 
  name       String
  quantity   Int
  eventItems EventItem[]
}

model Client {
  id      Float   @id 
  name    String
  phone   String?
  address String?
  cpf     String?
}

// --- AQUI ESTÁ A CORREÇÃO PRINCIPAL ---

model Company {
  id          Float   @id // Float para aceitar Date.now()
  name        String
  cnpj        String?
  address     String?
  phone       String?
  email       String?
  paymentInfo String?
  repName     String?
  repDoc      String?
  
  events      Event[] // Uma empresa tem vários eventos
}

model Event {
  id           Float    @id
  date         String   // Data de início
  endDate      String?  // Data de término (para eventos multi-dia)
  clientName   String?
  
  // Ligação com a Empresa
  yourCompanyId Float?
  company       Company? @relation(fields: [yourCompanyId], references: [id])

  // Relação com itens
  items        EventItem[]
  
  // Horários
  startTime    String?
  endTime      String?
  
  // Dados do Cliente PF
  clientType   String?
  clientCpf    String?
  clientRg     String?
  clientDob    String?
  clientPhone  String?
  clientPhoneBackup String?
  
  // Dados do Cliente PJ
  cnpj         String?
  companyAddress String?
  repName      String?
  repCpf       String?
  repPhone     String?
  repPhoneBackup String?
  
  // Endereço do Evento
  clientAddress    String?
  contractAddress  String?
  cep              String?
  complemento      String?
  bairro           String?
  cidade           String?
  uf               String?
  
  // Financeiro
  price            Float?
  subtotal         Float?
  discountType     String?
  discountValue    Float?
  deliveryFee      Float?
  paymentStatus    String?
  signalAmount     Float?
  signalReceived   Boolean?
  paymentDetails   String?
  
  // Outros
  monitor              String?
  eventObservations    String?
  isBirthday           Boolean?
  birthdayPersonName   String?
  birthdayPersonDob    String?
  status               String? 
}

model EventItem {
  id       Int   @id @default(autoincrement())
  quantity Int
  price    Float? // Preço específico desta locação
  
  eventId  Float
  event    Event @relation(fields: [eventId], references: [id])
  
  toyId    Float?
  toy      Toy?   @relation(fields: [toyId], references: [id])
}

// --- SEÇÃO FINANCEIRA E RH ---

model Monitor {
  id                String              @id
  nome              String
  cpf               String?             @unique
  nascimento        String?
  telefone          String?
  email             String?
  endereco          String?
  observacoes       String?
  cnh               Boolean?            @default(false)
  cnhCategoria      String?
  fotoPerfil        String?             // Base64 ou URL
  fotoDocumento     String?             // Base64 ou URL
  habilidades       String?             // JSON: {forca, agilidade, proatividade, comunicacao, disponibilidade, respeito}
  tipoSanguineo     String?
  medicamentos      String?
  restricoesAlimentares String?
  alergias          String?
  planoSaude        String?
  condicaoMedica    String?
  tamanhoCamiseta   String?
  escolaridade      String?
  possuiCursoPS     Boolean?            @default(false)
  fotoCertificadoPS String?             // Base64
  habilidadesEspecificas String?
  idiomas           String?             // JSON
  experiencias      String?
  fobias            String?
  contatoEmergenciaNome      String?
  contatoEmergenciaParentesco String?
  contatoEmergenciaTelefone  String?
  instagram         String?
  facebook          String?
  linkedin          String?
  tiktok            String?
  desempenho        Desempenho[]
  pagamentos        PagamentoMonitor[]
}

model Desempenho {
  id              String   @id
  data            String
  descricao       String?
  nota            String?  // Nota de 0-10
  obs             String?
  detalhes        String?  // JSON com checklist
  pagamentoId     String?  // Liga ao pagamento específico
  monitorId       String
  monitor         Monitor  @relation(fields: [monitorId], references: [id], onDelete: Cascade)
}

model PagamentoMonitor {
  id              String   @id
  data            String   // YYYY-MM-DD (Data do Evento)
  dataPagamento   String?  // YYYY-MM-DD
  eventoId        String?  // ID do evento vinculado (opcional)
  monitorId       String
  monitor         Monitor  @relation(fields: [monitorId], references: [id], onDelete: Cascade)
  nome            String   // Nome do monitor (denormalizado para performance)
  valorBase       Float    // Valor da diária base
  adicional       Float    // Adicional de motorista (R$ 20,00 por evento entregue)
  horasExtras     Float    // Valor de horas extras
  pagamento       Float    // Total = valorBase + adicional + horasExtras
  statusPagamento String   @default("Executado") // "Executado" ou "Pendente"
  horaEntrada     String?  // HH:MM
  horaSaida       String?  // HH:MM
  foiMotorista    Boolean  @default(false) // Se trabalhou como motorista
  numEventos      Float?   // Número de eventos entregues (para cálculo de adicional de motorista)
}

model Funcionario {
  id           String  @id
  nome         String
  salarioFixo  Float
  va           Float   // Vale Alimentação
  vt           Float   // Vale Transporte
}

model FaixaComissao {
  id         String  @id
  ateValor   Float   // Faturamento até esse valor
  percentual Float   // Percentual de comissão (ex: 0.02 = 2%)
}

model User {
  id                String    @id @default(uuid())
  name              String
  email             String    @unique
  password          String
  phone             String?   // Telefone do usuário
  photoUrl          String?   // URL ou base64 da foto de perfil
  isAdmin           Boolean   @default(false)
  emailConfirmed    Boolean   @default(false)
  verificationToken String?
  
  // --- NOVOS CAMPOS PARA RECUPERAÇÃO DE SENHA ---
  resetPasswordToken   String?
  resetPasswordExpires DateTime?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  tasks             Task[]   // Relacionamento com tarefas
  dailyPlans        DailyPlan[] // Relacionamento com planos diários
  pushSubscriptions PushSubscription[]
}

model Task {
  id        String   @id @default(uuid())
  text      String
  completed Boolean  @default(false)
  dueDate   String?  // YYYY-MM-DD
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DailyPlan {
  id        String   @id @default(uuid())
  date      String   // YYYY-MM-DD
  content   String   // JSON string of the plan
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, date]) // Apenas um plano por usuário por dia
}

// --- FINANÇAS ---

model Transaction {
  id            String   @id // Usaremos String para manter os IDs do JSON ("176217...")
  description   String
  amount        Float
  type          String   // "EXPENSE" (Gasto) ou "REVENUE" (Receita - opcional se usar Events)
  date          String   // YYYY-MM-DD
  category      String?  // Ex: "Combustível", "Alimentação"
  paymentMethod String?  // PIX, Boleto, etc.
  eventId       Float?   // Vincula receita a evento (NULL para entradas avulsas)
  accountId     String?  // Vincula a transação a uma conta bancária
  
  // Relacionamento opcional
  account       BankAccount? @relation(fields: [accountId], references: [id])
}

// --- CADASTROS FINANCEIROS ---

model BankAccount {
  id      String  @id
  name    String
  bank    String
  type    String
  agency  String?
  number  String?
  
  transactions Transaction[]
}

model FixedExpense {
  id             String  @id
  description    String
  amount         Float
  dueDay         Int
  category       String
  recurrenceType String  @default("permanente") // "permanente" ou "parcelada"
  startDate      String? // "YYYY-MM"
  installments   Int?
  attachments    String? // Guardaremos como JSON string se houver
}

// --- CATEGORIAS FINANCEIRAS ---

model ExpenseCategory {
  id   String @id
  name String
}

model FixedExpenseCategory {
  id   String @id
  name String
}
model PushSubscription {
  id        String   @id @default(uuid())
  endpoint  String   @unique
  p256dh    String
  auth      String
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}
