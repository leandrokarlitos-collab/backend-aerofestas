// Configurações iniciais
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- SEÇÃO DE ESTOQUE E EVENTOS ---

model Toy {
  id         Float       @id 
  name       String
  quantity   Int
  eventItems EventItem[]
}

model Client {
  id      Float   @id 
  name    String
  phone   String?
  address String?
  cpf     String?
}

// --- AQUI ESTÁ A CORREÇÃO PRINCIPAL ---

model Company {
  id          Float   @id // Float para aceitar Date.now()
  name        String
  cnpj        String?
  address     String?
  phone       String?
  email       String?
  paymentInfo String?
  repName     String?
  repDoc      String?
  
  events      Event[] // Uma empresa tem vários eventos
}

model Event {
  id           Float    @id
  date         String
  clientName   String?
  
  // Ligação com a Empresa (Correção do Erro 500)
  yourCompanyId Float?
  company       Company? @relation(fields: [yourCompanyId], references: [id])

  // Relação com itens
  items        EventItem[]
  
  // Outros campos úteis que seu frontend envia (Opcional adicionar agora ou depois)
  startTime    String?
  endTime      String?
  price        Float?
  status       String? 
}

model EventItem {
  id       Int   @id @default(autoincrement())
  quantity Int
  
  eventId  Float
  event    Event @relation(fields: [eventId], references: [id])
  
  toyId    Float?
  toy      Toy?   @relation(fields: [toyId], references: [id])
}

// --- SEÇÃO FINANCEIRA E RH ---

model Monitor {
  id            String       @id
  nome          String
  nascimento    String?
  telefone      String?
  email         String?
  endereco      String?
  cnh           Boolean?     @default(false)
  cnhCategoria  String?
  fotoPerfil    String?
  desempenho    Desempenho[]
}

model Desempenho {
  id          String   @id
  data        String
  descricao   String?
  nota        String?
  obs         String?
  detalhes    String?
  monitorId   String
  monitor     Monitor  @relation(fields: [monitorId], references: [id])
}

model User {
  id                String    @id @default(uuid())
  name              String
  email             String    @unique
  password          String
  isAdmin           Boolean   @default(false)
  emailConfirmed    Boolean   @default(false)
  verificationToken String?
  
  // --- NOVOS CAMPOS PARA RECUPERAÇÃO DE SENHA ---
  resetPasswordToken   String?
  resetPasswordExpires DateTime?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

// --- FINANÇAS ---

model Transaction {
  id          String   @id // Usaremos String para manter os IDs do JSON ("176217...")
  description String
  amount      Float
  type        String   // "EXPENSE" (Gasto) ou "REVENUE" (Receita - opcional se usar Events)
  date        String   // YYYY-MM-DD
  category    String?  // Ex: "Combustível", "Alimentação"
  paymentMethod String? // PIX, Boleto, etc.
  
  // Relacionamentos opcionais se quiser ligar a contas fixas depois
  // fixedAccountId String? 
}

// --- CADASTROS FINANCEIROS ---

model BankAccount {
  id      String  @id
  name    String
  bank    String
  type    String
  agency  String?
  number  String?
}

model FixedExpense {
  id             String  @id
  description    String
  amount         Float
  dueDay         Int
  category       String
  recurrenceType String  @default("permanente") // "permanente" ou "parcelada"
  startDate      String? // "YYYY-MM"
  installments   Int?
  attachments    String? // Guardaremos como JSON string se houver
}

// --- CATEGORIAS FINANCEIRAS ---

model ExpenseCategory {
  id   String @id
  name String
}

model FixedExpenseCategory {
  id   String @id
  name String
}