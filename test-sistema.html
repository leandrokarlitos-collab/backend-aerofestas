<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste do Sistema - Verifica√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8 bg-gray-100">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">Teste do Sistema - Verifica√ß√£o</h1>
        
        <div id="test-results" class="space-y-4">
            <div class="p-4 bg-blue-50 rounded-lg">
                <h2 class="font-semibold text-lg mb-2">üîç Verificando Sistema...</h2>
                <div id="status" class="text-gray-600">Carregando...</div>
            </div>
        </div>

        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-semibold mb-2">üìã Dados do LocalStorage:</h3>
            <pre id="localStorage-data" class="bg-white p-4 rounded text-sm overflow-auto max-h-96"></pre>
        </div>
    </div>

    <script>
        async function runTests() {
            const results = [];
            const statusEl = document.getElementById('status');
            const dataEl = document.getElementById('localStorage-data');

            // Teste 1: Verificar servidor
            statusEl.textContent = 'Testando conex√£o com servidor...';
            try {
                const response = await fetch('/api/health', { 
                    method: 'GET',
                    signal: AbortSignal.timeout(3000)
                });
                if (response.ok) {
                    results.push({ test: 'Servidor acess√≠vel', status: '‚úÖ OK', color: 'green' });
                } else {
                    results.push({ test: 'Servidor acess√≠vel', status: '‚ö†Ô∏è Erro na resposta', color: 'yellow' });
                }
            } catch (error) {
                results.push({ test: 'Servidor acess√≠vel', status: '‚ùå N√£o acess√≠vel (modo offline)', color: 'red' });
            }

            // Teste 2: Verificar autentica√ß√£o
            statusEl.textContent = 'Verificando autentica√ß√£o...';
            const token = localStorage.getItem('authToken');
            if (token) {
                try {
                    const response = await fetch('/api/auth/me', {
                        headers: { 'Authorization': `Bearer ${token}` },
                        signal: AbortSignal.timeout(3000)
                    });
                    if (response.ok) {
                        const userData = await response.json();
                        results.push({ 
                            test: 'Autentica√ß√£o', 
                            status: `‚úÖ Logado como: ${userData.name} (${userData.email})`, 
                            color: 'green' 
                        });
                    } else {
                        results.push({ test: 'Autentica√ß√£o', status: '‚ö†Ô∏è Token inv√°lido', color: 'yellow' });
                    }
                } catch (error) {
                    results.push({ test: 'Autentica√ß√£o', status: '‚ö†Ô∏è Erro ao verificar (modo offline)', color: 'yellow' });
                }
            } else {
                results.push({ test: 'Autentica√ß√£o', status: '‚ùå N√£o autenticado', color: 'red' });
            }

            // Teste 3: Verificar dados do localStorage
            statusEl.textContent = 'Verificando dados do localStorage...';
            const data = {
                authToken: localStorage.getItem('authToken') ? 'Presente' : 'Ausente',
                userData: localStorage.getItem('userData') ? 'Presente' : 'Ausente',
                toys: JSON.parse(localStorage.getItem('toys') || '[]'),
                companies: JSON.parse(localStorage.getItem('companies') || '[]'),
                events: JSON.parse(localStorage.getItem('events') || '[]'),
                clients: JSON.parse(localStorage.getItem('clients') || '[]'),
                crmClients: JSON.parse(localStorage.getItem('crmToyClients_v8') || '[]'),
                financeData: localStorage.getItem('financeDataV30') ? 'Presente' : 'Ausente',
                dailyPlanHistory: localStorage.getItem('dailyPlanHistory_v1') ? 'Presente' : 'Ausente',
                geminiApiKey: localStorage.getItem('geminiApiKey') ? 'Presente' : 'Ausente'
            };

            results.push({ 
                test: 'Dados do localStorage', 
                status: `‚úÖ ${data.toys.length} toys, ${data.companies.length} companies, ${data.events.length} events, ${data.clients.length} clients`, 
                color: 'green' 
            });

            // Exibir resultados
            const resultsEl = document.getElementById('test-results');
            resultsEl.innerHTML = results.map(r => `
                <div class="p-4 border-l-4 ${r.color === 'green' ? 'border-green-500 bg-green-50' : r.color === 'yellow' ? 'border-yellow-500 bg-yellow-50' : 'border-red-500 bg-red-50'} rounded">
                    <div class="font-semibold">${r.test}</div>
                    <div class="text-sm mt-1">${r.status}</div>
                </div>
            `).join('');

            // Exibir dados do localStorage
            dataEl.textContent = JSON.stringify(data, null, 2);
            statusEl.textContent = '‚úÖ Testes conclu√≠dos!';
        }

        // Executar testes quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>

