<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migra√ß√£o de Dados - LocalStorage</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8 bg-gray-100">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">üîÑ Migra√ß√£o de Dados do LocalStorage</h1>
        
        <div class="mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">
            <h2 class="font-bold mb-2">üìù Instru√ß√µes</h2>
            <ol class="list-decimal list-inside space-y-2 text-sm">
                <li>Abra o arquivo <code class="bg-gray-200 px-2 py-1 rounded">example/Agenda de eventos.html</code> diretamente no navegador (file://)</li>
                <li>Abra o Console do Navegador (F12)</li>
                <li>Execute este comando no console:</li>
            </ol>
            <pre class="bg-gray-800 text-green-400 p-4 rounded mt-2 overflow-auto text-xs">console.log(JSON.stringify({
    toys: JSON.parse(localStorage.getItem('toys') || '[]'),
    companies: JSON.parse(localStorage.getItem('companies') || '[]'),
    events: JSON.parse(localStorage.getItem('events') || '[]'),
    clients: JSON.parse(localStorage.getItem('clients') || '[]'),
    crmToyClients_v8: JSON.parse(localStorage.getItem('crmToyClients_v8') || '[]')
}));</pre>
            <ol start="4" class="list-decimal list-inside space-y-2 text-sm mt-4">
                <li>Copie a sa√≠da JSON que aparecer no console</li>
                <li>Cole no campo abaixo e clique em "Importar Dados"</li>
            </ol>
        </div>

        <div class="mb-6">
            <label class="block font-semibold mb-2">Op√ß√£o 1: Carregar arquivo JSON</label>
            <input 
                type="file" 
                id="arquivoJson" 
                accept=".json"
                class="w-full p-4 border-2 border-dashed rounded hover:border-blue-500 cursor-pointer"
                onchange="carregarArquivo(this)"
            />
        </div>

        <div class="mb-6">
            <label class="block font-semibold mb-2">Op√ß√£o 2: Cole os dados JSON aqui:</label>
            <textarea 
                id="dadosJson" 
                class="w-full h-64 p-4 border rounded font-mono text-xs"
                placeholder='{"toys":[],"companies":[],"events":[],"clients":[],"crmToyClients_v8":[]}'
            ></textarea>
        </div>

        <div class="flex gap-4 mb-6">
            <button onclick="importarDados()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold">
                Importar Dados
            </button>
            <button onclick="validarDados()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold">
                Validar JSON
            </button>
            <button onclick="limparDados()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-semibold">
                Limpar Todos os Dados
            </button>
        </div>

        <div id="resultado" class="space-y-2"></div>

        <div class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
            <h2 class="font-bold mb-2">‚ÑπÔ∏è M√©todo Alternativo (Mais R√°pido)</h2>
            <ol class="list-decimal list-inside space-y-2 text-sm">
                <li>Abra <code class="bg-gray-200 px-2 py-1 rounded">example/Agenda de eventos.html</code> no navegador</li>
                <li>Abra o Console (F12) e execute:</li>
            </ol>
            <pre class="bg-gray-800 text-green-400 p-4 rounded mt-2 overflow-auto text-xs">// Copiar para clipboard
const dados = {
    toys: JSON.parse(localStorage.getItem('toys') || '[]'),
    companies: JSON.parse(localStorage.getItem('companies') || '[]'),
    events: JSON.parse(localStorage.getItem('events') || '[]'),
    clients: JSON.parse(localStorage.getItem('clients') || '[]'),
    crmToyClients_v8: JSON.parse(localStorage.getItem('crmToyClients_v8') || '[]')
};
copy(JSON.stringify(dados));</pre>
            <ol start="3" class="list-decimal list-inside space-y-2 text-sm mt-4">
                <li>Volte para esta p√°gina</li>
                <li>Cole no campo acima (Ctrl+V)</li>
                <li>Clique em "Importar Dados"</li>
            </ol>
        </div>
    </div>

    <script>
        function carregarArquivo(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const textarea = document.getElementById('dadosJson');
                textarea.value = e.target.result;
                
                // Validar automaticamente
                validarDados();
            };
            reader.readAsText(file);
        }

        function validarDados() {
            const textarea = document.getElementById('dadosJson');
            const resultado = document.getElementById('resultado');
            
            try {
                const dados = JSON.parse(textarea.value);
                
                let html = '<div class="p-4 bg-green-50 border-l-4 border-green-500 rounded">';
                html += '<h3 class="font-bold text-green-800 mb-2">‚úÖ JSON v√°lido!</h3>';
                html += '<div class="text-sm space-y-1">';
                
                if (dados.toys) html += `<div>Toys: ${Array.isArray(dados.toys) ? dados.toys.length : 'erro'} itens</div>`;
                if (dados.companies) html += `<div>Companies: ${Array.isArray(dados.companies) ? dados.companies.length : 'erro'} itens</div>`;
                if (dados.events) html += `<div>Events: ${Array.isArray(dados.events) ? dados.events.length : 'erro'} itens</div>`;
                if (dados.clients) html += `<div>Clients: ${Array.isArray(dados.clients) ? dados.clients.length : 'erro'} itens</div>`;
                if (dados.crmToyClients_v8) html += `<div>CRM Clients: ${Array.isArray(dados.crmToyClients_v8) ? dados.crmToyClients_v8.length : 'erro'} itens</div>`;
                
                html += '</div></div>';
                resultado.innerHTML = html;
            } catch (error) {
                resultado.innerHTML = `<div class="p-4 bg-red-50 border-l-4 border-red-500 rounded">
                    <h3 class="font-bold text-red-800 mb-2">‚ùå Erro ao validar JSON</h3>
                    <div class="text-sm">${error.message}</div>
                </div>`;
            }
        }

        function importarDados() {
            const textarea = document.getElementById('dadosJson');
            const resultado = document.getElementById('resultado');
            
            try {
                const dados = JSON.parse(textarea.value);
                
                // Salvar no localStorage
                if (dados.toys) {
                    localStorage.setItem('toys', JSON.stringify(dados.toys));
                }
                if (dados.companies) {
                    localStorage.setItem('companies', JSON.stringify(dados.companies));
                }
                if (dados.events) {
                    localStorage.setItem('events', JSON.stringify(dados.events));
                }
                if (dados.clients) {
                    localStorage.setItem('clients', JSON.stringify(dados.clients));
                }
                if (dados.crmToyClients_v8) {
                    localStorage.setItem('crmToyClients_v8', JSON.stringify(dados.crmToyClients_v8));
                }
                // Dados Financeiros (importa a vers√£o mais recente encontrada)
                if (dados.financeDataV30) {
                    localStorage.setItem('financeDataV30', JSON.stringify(dados.financeDataV30));
                } else if (dados.financeDataV29) {
                    localStorage.setItem('financeDataV30', JSON.stringify(dados.financeDataV29));
                } else if (dados.financeDataV22) {
                    localStorage.setItem('financeDataV30', JSON.stringify(dados.financeDataV22));
                } else if (dados.financeDataV23) {
                    localStorage.setItem('financeDataV30', JSON.stringify(dados.financeDataV23));
                } else if (dados.financeDataV21) {
                    localStorage.setItem('financeDataV30', JSON.stringify(dados.financeDataV21));
                }
                // Dashboard
                if (dados.dailyPlanHistory_v1) {
                    localStorage.setItem('dailyPlanHistory_v1', JSON.stringify(dados.dailyPlanHistory_v1));
                }
                // Gemini API Key
                if (dados.geminiApiKey) {
                    localStorage.setItem('geminiApiKey', dados.geminiApiKey);
                }
                
                const hasFinanceData = dados.financeDataV30 || dados.financeDataV29 || dados.financeDataV22 || dados.financeDataV23 || dados.financeDataV21;
                
                let html = '<div class="p-4 bg-green-50 border-l-4 border-green-500 rounded">';
                html += '<h3 class="font-bold text-green-800 mb-2">‚úÖ Dados importados com sucesso!</h3>';
                html += '<div class="text-sm space-y-1">';
                html += `<div>‚úì Toys: ${dados.toys ? dados.toys.length : 0} itens</div>`;
                html += `<div>‚úì Companies: ${dados.companies ? dados.companies.length : 0} itens</div>`;
                html += `<div>‚úì Events: ${dados.events ? dados.events.length : 0} itens</div>`;
                html += `<div>‚úì Clients: ${dados.clients ? dados.clients.length : 0} itens</div>`;
                html += `<div>‚úì CRM Clients: ${dados.crmToyClients_v8 ? dados.crmToyClients_v8.length : 0} itens</div>`;
                html += `<div>‚úì Dados Financeiros: ${hasFinanceData ? '‚úÖ Importado' : '‚ùå N√£o encontrado'}</div>`;
                html += `<div>‚úì Planos Di√°rios: ${dados.dailyPlanHistory_v1 ? '‚úÖ Importado' : '‚ùå N√£o encontrado'}</div>`;
                html += '</div>';
                html += '<div class="mt-4 pt-4 border-t border-green-200 space-x-2">';
                html += '<a href="/Agenda de eventos.html" class="inline-block bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold">Agenda de Eventos</a>';
                html += '<a href="/Sistema Gest√£o Financeira.html" class="inline-block bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-semibold">Gest√£o Financeira</a>';
                html += '<a href="/Sistema de CRM.html" class="inline-block bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold">CRM</a>';
                html += '</div>';
                html += '</div>';
                
                resultado.innerHTML = html;
                
                // Limpar textarea
                textarea.value = '';
            } catch (error) {
                resultado.innerHTML = `<div class="p-4 bg-red-50 border-l-4 border-red-500 rounded">
                    <h3 class="font-bold text-red-800 mb-2">‚ùå Erro ao importar dados</h3>
                    <div class="text-sm">${error.message}</div>
                </div>`;
            }
        }

        function limparDados() {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja LIMPAR TODOS OS DADOS do localStorage? Esta a√ß√£o n√£o pode ser desfeita!')) {
                localStorage.removeItem('toys');
                localStorage.removeItem('companies');
                localStorage.removeItem('events');
                localStorage.removeItem('clients');
                localStorage.removeItem('crmToyClients_v8');
                
                document.getElementById('resultado').innerHTML = `<div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                    <h3 class="font-bold text-yellow-800 mb-2">‚ö†Ô∏è Dados limpos</h3>
                    <div class="text-sm">Todos os dados foram removidos do localStorage.</div>
                </div>`;
            }
        }
    </script>
</body>
</html>

