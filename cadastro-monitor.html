<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Monitor - Aero Festas</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                        },
                        accent: '#4f46e5'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .input-focus {
            transition: all 0.3s ease;
        }

        .input-focus:focus {
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.15);
            border-color: #0ea5e9;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #475569;
            margin-bottom: 0.4rem;
            display: block;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-upload-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-upload-btn:hover {
            background: #f1f5f9;
            border-color: #94a3b8;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            object-fit: contain;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0ea5e9;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Custom Select Appearance */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%2364748b%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }
    </style>
</head>

<body class="py-12 px-4 sm:px-6 lg:px-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12 animate-fade-in">
            <div class="inline-flex items-center justify-center p-4 bg-white rounded-3xl shadow-sm mb-6">
                <i class="fa-solid fa-user-check text-primary-600 text-4xl"></i>
            </div>
            <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight" id="page-title">Cadastro de Monitor</h1>
            <p class="mt-3 text-slate-500 text-lg font-medium" id="page-subtitle">Fa√ßa parte do time que leva alegria
                para todo o Brasil.</p>
        </div>

        <!-- Passo 1: Identifica√ß√£o -->
        <div id="step-id" class="glass-card p-10 sm:p-12 rounded-[2.5rem] space-y-10 animate-slide-up">
            <div class="text-center space-y-2">
                <h2 class="text-2xl font-bold text-slate-800">Vamos come√ßar?</h2>
                <p class="text-slate-500">Informe seus dados b√°sicos para continuarmos.</p>
            </div>

            <div class="space-y-6">
                <div>
                    <label for="check-nome" class="form-label text-base">Seu Nome Completo</label>
                    <input type="text" id="check-nome" placeholder="Como no documento"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 text-lg shadow-sm">
                </div>
                <div>
                    <label for="check-nascimento" class="form-label text-base">Data de Nascimento</label>
                    <input type="date" id="check-nascimento"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 text-lg shadow-sm">
                </div>

                <div id="cpf-verify-wrapper" class="hidden space-y-4 animate-fade-in border-t border-slate-100 pt-6">
                    <div class="flex items-center gap-2 text-primary-600 mb-2">
                        <i class="fa-solid fa-shield-halved"></i>
                        <span class="text-xs font-bold uppercase tracking-wider">Verifica√ß√£o de Seguran√ßa</span>
                    </div>
                    <label for="check-cpf" class="form-label text-base">Informe seu CPF para confirmar</label>
                    <input type="text" id="check-cpf" placeholder="000.000.000-00"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none text-slate-700 text-lg focus:ring-4 focus:ring-primary-500/10 transition-all">
                    <p class="text-[10px] text-slate-400 leading-tight">Para sua seguran√ßa, confirme seu CPF para
                        acessar/editar seus dados.</p>
                </div>
            </div>

            <button id="btn-iniciar"
                class="w-full py-5 bg-primary-600 hover:bg-primary-700 text-white font-bold text-xl rounded-2xl shadow-2xl shadow-primary-500/30 transition-all flex items-center justify-center gap-3">
                <span id="btn-iniciar-text">Acessar Identidade Aero</span>
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>

        <div class="pt-6 border-t border-slate-100/50">
            <p class="text-[10px] text-slate-400 text-center leading-relaxed">
                <i class="fa-solid fa-lock mr-1"></i>
                Os dados pessoais coletados ser√£o tratados exclusivamente para fins de cadastro, formaliza√ß√£o, gest√£o e
                execu√ß√£o da presta√ß√£o de servi√ßos, bem como para o cumprimento de obriga√ß√µes legais, fiscais,
                regulat√≥rias e administrativas, nos termos da Lei n¬∫ 13.709/2018 (LGPD).
            </p>
        </div>
    </div>

    <!-- Form Success State -->
    <div id="success-state" class="hidden glass-card p-12 rounded-[2.5rem] text-center animate-slide-up">
        <div
            class="w-24 h-24 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner">
            <i class="fa-solid fa-check text-5xl"></i>
        </div>
        <h2 class="text-3xl font-bold text-slate-800 mb-3">Cadastro Realizado!</h2>
        <p class="text-slate-500 text-lg mb-10">Seus dados foram processados. Em breve entraremos em contato!</p>
        <button onclick="window.location.reload()"
            class="px-10 py-4 bg-primary-600 hover:bg-primary-700 text-white font-bold rounded-2xl shadow-xl transition-all transform hover:-translate-y-1">
            Novo Cadastro
        </button>
    </div>

    <!-- Passo 2: O Formul√°rio -->
    <form id="monitor-form" class="hidden glass-card p-10 sm:p-14 rounded-[2.5rem] space-y-16 animate-slide-up">
        <input type="hidden" id="monitor-id">

        <div id="update-badge"
            class="hidden bg-indigo-100/80 text-indigo-700 px-6 py-4 rounded-2xl text-base font-bold flex items-center gap-3 border border-indigo-200">
            <div class="bg-indigo-600 text-white p-2 rounded-lg"><i class="fa-solid fa-id-card"></i></div>
            <span>Monitor detectado! Mantenha seus dados sempre atualizados.</span>
        </div>

        <!-- Se√ß√£o 1: Dados Pessoais -->
        <section class="space-y-8">
            <h3 class="section-title text-2xl"><i class="fa-solid fa-fingerprint text-primary-500"></i> Identidade
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="md:col-span-2">
                    <label for="nome" class="form-label">Nome Completo</label>
                    <input type="text" id="nome" name="nome" readonly
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-slate-100/50 outline-none text-slate-400 font-medium cursor-not-allowed">
                </div>
                <div>
                    <label for="nascimento" class="form-label">Data de Nascimento</label>
                    <input type="date" id="nascimento" name="nascimento" readonly
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-slate-100/50 outline-none text-slate-400 font-medium cursor-not-allowed">
                </div>
                <div class="relative">
                    <label for="telefone" class="form-label">WhatsApp</label>
                    <input type="text" id="telefone" name="telefone" required placeholder="(00) 00000-0000"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                </div>
                <div class="md:col-span-2">
                    <label for="email" class="form-label">E-mail</label>
                    <input type="email" id="email" name="email" placeholder="seu@email.com" required
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm transition-all">
                    <div class="mt-2 flex items-center gap-2">
                        <input type="checkbox" id="no-email"
                            class="w-4 h-4 text-primary-600 rounded border-slate-300 focus:ring-primary-500"
                            onchange="toggleNoEmail(this)">
                        <label for="no-email"
                            class="text-xs text-slate-500 font-medium cursor-pointer uppercase tracking-wider">N√£o
                            possuo e-mail</label>
                    </div>
                </div>
                <div>
                    <label for="cpf" class="form-label">CPF</label>
                    <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" required
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                </div>
                <div class="md:col-span-2">
                    <label for="endereco" class="form-label">Endere√ßo Completo</label>
                    <input type="text" id="endereco" name="endereco" placeholder="Rua, N√∫mero, Bairro, Cidade"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 md:col-span-2">
                    <div>
                        <label for="cnh" class="form-label">Possui CNH?</label>
                        <select id="cnh" name="cnh"
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                            <option value="false">N√£o</option>
                            <option value="true">Sim</option>
                        </select>
                    </div>
                    <div id="cnh-categoria-wrapper" class="hidden">
                        <label for="cnhCategoria" class="form-label">Categoria</label>
                        <input type="text" id="cnhCategoria" name="cnhCategoria" placeholder="Ex: AB, D"
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                    </div>
                </div>
                <div>
                    <label for="tamanhoCamiseta" class="form-label">Uniforme (Tamanho)</label>
                    <select id="tamanhoCamiseta" name="tamanhoCamiseta"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                        <option value="">Selecione...</option>
                        <option value="PP">PP</option>
                        <option value="P">P</option>
                        <option value="M">M</option>
                        <option value="G">G</option>
                        <option value="GG">GG</option>
                        <option value="XG">XG</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o 2: Sa√∫de e Seguran√ßa -->
        <section class="space-y-10">
            <h3 class="section-title text-2xl"><i class="fa-solid fa-kit-medical text-red-500"></i> Sa√∫de &
                Emerg√™ncia</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-8">
                <div>
                    <label for="tipoSanguineo" class="form-label">Tipo Sangu√≠neo</label>
                    <select id="tipoSanguineo" name="tipoSanguineo"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                        <option value="">Selecione...</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>

                <!-- Plano de Sa√∫de -->
                <div class="md:col-span-2 space-y-3">
                    <label class="form-label">Possui Plano de Sa√∫de?</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_plano" value="true" class="hidden peer"
                                onchange="toggleHealthField(this, 'plano-wrapper')">
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-primary-50 peer-checked:border-primary-500 transition-all font-bold text-slate-600 peer-checked:text-primary-600">
                                Sim</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_plano" value="false" class="hidden peer"
                                onchange="toggleHealthField(this, 'plano-wrapper')" checked>
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-red-50 peer-checked:border-red-500 transition-all font-bold text-slate-600 peer-checked:text-red-600">
                                N√£o</div>
                        </label>
                    </div>
                    <div id="plano-wrapper" class="hidden pt-2 animate-fade-in">
                        <input type="text" id="planoSaude" name="planoSaude"
                            placeholder="Qual o plano? (Ex: Unimed) Dados?"
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none focus:ring-4 focus:ring-primary-500/10">
                    </div>
                </div>

                <!-- Medicamentos -->
                <div class="md:col-span-2 space-y-3">
                    <label class="form-label text-red-600">Usa Medicamento de Uso Cont√≠nuo?</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_medicamento" value="true" class="hidden peer"
                                onchange="toggleHealthField(this, 'medicamento-wrapper')">
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-primary-50 peer-checked:border-primary-500 transition-all font-bold text-slate-600">
                                Sim</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_medicamento" value="false" class="hidden peer"
                                onchange="toggleHealthField(this, 'medicamento-wrapper')" checked>
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-emerald-50 peer-checked:border-emerald-500 transition-all font-bold text-slate-600">
                                N√£o</div>
                        </label>
                    </div>
                    <div id="medicamento-wrapper" class="hidden pt-2">
                        <textarea id="medicamentos" name="medicamentos" rows="2"
                            placeholder="Quais medicamentos, para qu√™ e qual frequ√™ncia?"
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm resize-none outline-none focus:ring-4 focus:ring-primary-500/10"></textarea>
                    </div>
                </div>

                <!-- Restri√ß√µes Alimentares -->
                <div class="md:col-span-2 space-y-3">
                    <label class="form-label">Possui Alguma Restri√ß√£o Alimentar? (Ex: Lactose, Gl√∫ten)</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_restricao" value="true" class="hidden peer"
                                onchange="toggleHealthField(this, 'restricao-wrapper')">
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-primary-50 peer-checked:border-primary-500 transition-all font-bold text-slate-600">
                                Sim</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_restricao" value="false" class="hidden peer"
                                onchange="toggleHealthField(this, 'restricao-wrapper')" checked>
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-emerald-50 peer-checked:border-emerald-500 transition-all font-bold text-slate-600">
                                N√£o</div>
                        </label>
                    </div>
                    <div id="restricao-wrapper" class="hidden pt-2">
                        <textarea id="restricoesAlimentares" name="restricoesAlimentares" rows="2"
                            placeholder="Descreva as restri√ß√µes..."
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm resize-none outline-none"></textarea>
                    </div>
                </div>

                <!-- Alergias -->
                <div class="md:col-span-2 space-y-3">
                    <label class="form-label text-amber-600">Possui Alguma Alergia?</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_alergia" value="true" class="hidden peer"
                                onchange="toggleHealthField(this, 'alergia-wrapper')">
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-primary-50 peer-checked:border-primary-500 transition-all font-bold text-slate-600">
                                Sim</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_alergia" value="false" class="hidden peer"
                                onchange="toggleHealthField(this, 'alergia-wrapper')" checked>
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-emerald-50 peer-checked:border-emerald-500 transition-all font-bold text-slate-600">
                                N√£o</div>
                        </label>
                    </div>
                    <div id="alergia-wrapper" class="hidden pt-2">
                        <textarea id="alergias" name="alergias" rows="2" placeholder="Alergia a qu√™? Rea√ß√µes?"
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm resize-none outline-none"></textarea>
                    </div>
                </div>

                <!-- Condi√ß√£o M√©dica -->
                <div class="md:col-span-2 space-y-3">
                    <label class="form-label">Possui Alguma Condi√ß√£o M√©dica ou F√≠sica?</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_condicao" value="true" class="hidden peer"
                                onchange="toggleHealthField(this, 'condicao-wrapper')">
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-primary-50 peer-checked:border-primary-500 transition-all font-bold text-slate-600">
                                Sim</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_condicao" value="false" class="hidden peer"
                                onchange="toggleHealthField(this, 'condicao-wrapper')" checked>
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-emerald-50 peer-checked:border-emerald-500 transition-all font-bold text-slate-600">
                                N√£o</div>
                        </label>
                    </div>
                    <div id="condicao-wrapper" class="hidden pt-2">
                        <textarea id="condicaoMedica" name="condicaoMedica" rows="2"
                            placeholder="Labirintite, les√µes, asma..."
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm resize-none outline-none"></textarea>
                    </div>
                </div>

                <!-- Fobias -->
                <div class="md:col-span-2 space-y-3">
                    <label class="form-label">Possui Medo Intenso ou Fobia?</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_fobia" value="true" class="hidden peer"
                                onchange="toggleHealthField(this, 'fobia-wrapper')">
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-primary-50 peer-checked:border-primary-500 transition-all font-bold text-slate-600">
                                Sim</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="has_fobia" value="false" class="hidden peer"
                                onchange="toggleHealthField(this, 'fobia-wrapper')" checked>
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-emerald-50 peer-checked:border-emerald-500 transition-all font-bold text-slate-600">
                                N√£o</div>
                        </label>
                    </div>
                    <div id="fobia-wrapper" class="hidden pt-2">
                        <input type="text" id="fobias" name="fobias"
                            placeholder="Ex: Altura, palha√ßos, lugares fechados..."
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none focus:ring-4 focus:ring-primary-500/10">
                    </div>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o 3: Forma√ß√£o -->
        <section class="space-y-10">
            <h3 class="section-title text-2xl"><i class="fa-solid fa-graduation-cap text-indigo-500"></i> Forma√ß√£o &
                Habilidades</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-10">
                <div class="md:col-span-2">
                    <label for="escolaridade" class="form-label">Escolaridade</label>
                    <select id="escolaridade" name="escolaridade" onchange="handleEscolaridade(this)"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none text-slate-700 shadow-sm">
                        <option value="">Selecione...</option>
                        <option value="Ensino M√©dio Incompleto">Ensino M√©dio Incompleto</option>
                        <option value="Ensino M√©dio Completo">Ensino M√©dio Completo</option>
                        <option value="Superior Incompleto">Superior Incompleto</option>
                        <option value="Superior Completo">Superior Completo</option>
                        <option value="P√≥s-Gradua√ß√£o">P√≥s-Gradua√ß√£o</option>
                    </select>
                    <div id="escolaridade-desc-wrapper" class="hidden pt-4">
                        <input type="text" id="escolaridade_curso" placeholder="Qual curso? Em qual institui√ß√£o?"
                            class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none">
                    </div>
                </div>

                <!-- Primeiro Socorros -->
                <div class="md:col-span-2 space-y-4">
                    <label class="form-label">Possui Certificado de Primeiros Socorros?</label>
                    <div class="flex gap-4 mb-2">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="possuiCursoPS" value="true" class="hidden peer"
                                onchange="toggleHealthField(this, 'ps-doc-wrapper')">
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-white peer-checked:border-primary-500 peer-checked:shadow-primary-100 peer-checked:shadow-lg transition-all font-bold">
                                Sim</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="possuiCursoPS" value="false" class="hidden peer"
                                onchange="toggleHealthField(this, 'ps-doc-wrapper')" checked>
                            <div
                                class="p-4 text-center rounded-2xl border border-slate-200 peer-checked:bg-white peer-checked:border-red-500 peer-checked:shadow-red-100 peer-checked:shadow-lg transition-all font-bold">
                                N√£o</div>
                        </label>
                    </div>
                    <div id="ps-doc-wrapper"
                        class="hidden pt-2 border-2 border-dashed border-slate-200 rounded-3xl p-6 bg-slate-50/50">
                        <label class="file-upload-wrapper">
                            <div class="file-upload-btn mb-4">
                                <input type="file" id="fotoPSInput" accept="image/*" class="hidden"
                                    onchange="previewFile(this, 'preview-ps', 'foto-ps-base64')">
                                <div class="text-center">
                                    <i class="fa-solid fa-file-shield text-3xl text-primary-500 mb-2"></i>
                                    <span class="block text-sm text-slate-500 font-bold">Enviar Foto do
                                        Certificado</span>
                                </div>
                            </div>
                            <input type="hidden" id="foto-ps-base64">
                            <img id="preview-ps" class="preview-image hidden mx-auto shadow-2xl border-4 border-white">
                        </label>
                    </div>
                </div>

                <!-- Idiomas -->
                <div class="md:col-span-2">
                    <label class="form-label mb-3">Idiomas</label>
                    <div id="idiomas-container" class="space-y-4">
                        <!-- Idiomas ser√£o adicionados aqui -->
                    </div>
                    <button type="button" onclick="addIdiomaRow()"
                        class="mt-4 flex items-center justify-center gap-2 w-full py-4 bg-white text-primary-600 font-bold border-2 border-primary-100 rounded-2xl hover:bg-primary-50 hover:border-primary-200 transition-all shadow-sm">
                        <i class="fa-solid fa-plus-circle"></i> Adicionar Idioma
                    </button>
                </div>

                <div class="md:col-span-2">
                    <label for="habilidadesEspecificas" class="form-label">Destaques Aero (M√°gica, Dan√ßa, Esportes,
                        etc.)</label>
                    <textarea id="habilidadesEspecificas" name="habilidadesEspecificas" rows="2"
                        placeholder="Quais suas habilidades especiais que encantam o p√∫blico?"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none shadow-sm"></textarea>
                </div>

                <div class="md:col-span-2">
                    <label for="experiencias" class="form-label">Sua Jornada (Experi√™ncias)</label>
                    <textarea id="experiencias" name="experiencias" rows="3" placeholder="Onde j√° trabalhou?"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none shadow-sm"></textarea>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o 4: Redes Sociais -->
        <section class="space-y-10">
            <h3 class="section-title text-2xl"><i class="fa-solid fa-hashtag text-pink-500"></i> Presen√ßa Digital
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="relative">
                    <i class="fa-brands fa-instagram absolute left-5 top-[3.25rem] text-pink-500 text-xl"></i>
                    <label for="instagram" class="form-label">Instagram</label>
                    <input type="text" id="instagram" placeholder="@usuario"
                        class="w-full pl-12 pr-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none focus:ring-4 focus:ring-pink-500/10">
                </div>
                <div class="relative">
                    <i class="fa-brands fa-facebook absolute left-5 top-[3.25rem] text-blue-600 text-xl"></i>
                    <label for="facebook" class="form-label">Facebook</label>
                    <input type="text" id="facebook" placeholder="Perfil ou Link"
                        class="w-full pl-12 pr-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none">
                </div>
                <div class="relative">
                    <i class="fa-brands fa-linkedin absolute left-5 top-[3.25rem] text-blue-700 text-xl"></i>
                    <label for="linkedin" class="form-label">LinkedIn</label>
                    <input type="text" id="linkedin" placeholder="LinkedIn URL"
                        class="w-full pl-12 pr-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none">
                </div>
                <div class="relative">
                    <i class="fa-brands fa-tiktok absolute left-5 top-[3.25rem] text-black text-xl"></i>
                    <label for="tiktok" class="form-label">TikTok</label>
                    <input type="text" id="tiktok" placeholder="@usuario"
                        class="w-full pl-12 pr-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none">
                </div>
            </div>
        </section>

        <!-- Se√ß√£o 5: Contato de Refer√™ncia -->
        <section class="space-y-10">
            <h3 class="section-title text-2xl"><i class="fa-solid fa-phone-volume text-red-500"></i> Contato de
                Refer√™ncia (Emerg√™ncia)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="contatoEmergenciaParentesco" class="form-label">N√≠vel de Parentesco</label>
                    <select id="contatoEmergenciaParentesco" name="contatoEmergenciaParentesco"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none focus:ring-4 focus:ring-primary-500/10">
                        <option value="">Selecione...</option>
                        <option value="M√£e">M√£e</option>
                        <option value="Pai">Pai</option>
                        <option value="Esposa/Esposo">Esposa/Esposo</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                <div>
                    <label for="contatoEmergenciaNome" class="form-label">Nome do Contato</label>
                    <input type="text" id="contatoEmergenciaNome" name="contatoEmergenciaNome"
                        placeholder="Nome Completo"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none focus:ring-4 focus:ring-primary-500/10">
                </div>
                <div>
                    <label for="contatoEmergenciaTelefone" class="form-label">Telefone do Contato</label>
                    <input type="text" id="contatoEmergenciaTelefone" name="contatoEmergenciaTelefone"
                        placeholder="(00) 00000-0000"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white shadow-sm outline-none focus:ring-4 focus:ring-primary-500/10">
                </div>
            </div>
        </section>

        <!-- Se√ß√£o 5: Documentos -->
        <section class="space-y-10">
            <h3 class="section-title text-2xl"><i class="fa-solid fa-camera-retro text-slate-500"></i> Fotos
                Oficiais</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="space-y-4">
                    <label class="form-label">Sua Foto (No Estilo Aero!)</label>
                    <div
                        class="file-upload-wrapper border-2 border-dashed border-slate-200 rounded-[2rem] p-4 bg-white hover:bg-slate-50 transition-all">
                        <label class="file-upload-btn border-none bg-transparent">
                            <input type="file" id="fotoPerfilInput" accept="image/*" class="hidden"
                                onchange="previewFile(this, 'preview-perfil', 'foto-perfil-base64')">
                            <div class="text-center">
                                <div
                                    class="w-16 h-16 bg-primary-100 text-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg shadow-primary-500/10">
                                    <i class="fa-solid fa-smile-wink text-2xl"></i>
                                </div>
                                <span class="block text-sm text-slate-500 font-bold">Enviar Foto Rosto</span>
                            </div>
                        </label>
                        <input type="hidden" id="foto-perfil-base64">
                        <img id="preview-perfil" class="preview-image hidden mx-auto shadow-2xl border-4 border-white">
                    </div>
                </div>

                <div class="space-y-4">
                    <label class="form-label">Foto do Documento (ID/CNH)</label>
                    <div
                        class="file-upload-wrapper border-2 border-dashed border-slate-200 rounded-[2rem] p-4 bg-white hover:bg-slate-50 transition-all">
                        <label class="file-upload-btn border-none bg-transparent">
                            <input type="file" id="fotoDocInput" accept="image/*" class="hidden"
                                onchange="previewFile(this, 'preview-doc', 'foto-doc-base64')">
                            <div class="text-center">
                                <div
                                    class="w-16 h-16 bg-slate-100 text-slate-600 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                    <i class="fa-solid fa-address-card text-2xl"></i>
                                </div>
                                <span class="block text-sm text-slate-500 font-bold">Frente e Verso</span>
                            </div>
                        </label>
                        <input type="hidden" id="foto-doc-base64">
                        <img id="preview-doc" class="preview-image hidden mx-auto shadow-2xl border-4 border-white">
                    </div>
                </div>

                <div class="md:col-span-2">
                    <label for="observacoes" class="form-label">Mensagem para Aero Festas</label>
                    <textarea id="observacoes" name="observacoes" rows="3" placeholder="Alguma considera√ß√£o final?"
                        class="w-full px-5 py-4 rounded-2xl border border-slate-200 bg-white/50 input-focus outline-none shadow-sm"></textarea>
                </div>
            </div>
        </section>

        <div class="pt-10">
            <button type="submit" id="submit-btn"
                class="w-full py-6 bg-primary-600 hover:bg-primary-700 text-white font-bold text-2xl rounded-3xl shadow-2xl shadow-primary-500/40 transition-all transform hover:-translate-y-2 active:scale-95 flex items-center justify-center gap-4">
                <i class="fa-solid fa-check-circle"></i>
                <span>Tudo pronto! Finalizar Cadastro</span>
            </button>
        </div>
    </form>

    <footer class="mt-20 mb-12 text-center">
        <p class="text-slate-400 text-sm font-bold uppercase tracking-widest">&copy; 2026 Aero Festas Entertainment
        </p>
        <div class="flex justify-center gap-6 mt-4 text-slate-300">
            <i class="fa-brands fa-instagram text-xl"></i>
            <i class="fa-brands fa-facebook text-xl"></i>
            <i class="fa-brands fa-whatsapp text-xl"></i>
        </div>
    </footer>
    </div>

    <!-- Script Logic -->
    <script>
        const API_BASE = "https://backend-aerofestas-production.up.railway.app/api";

        // --- CONFIGURA√á√ÉO CLOUDINARY ---
        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dyqgxvptu/image/upload";
        const CLOUDINARY_PRESET = "c4h43hti";

        // Fun√ß√£o para comprimir imagem no Navegador (Performance & Economia)
        async function compressImage(base64Str, maxWidth = 1200, maxHeight = 1200) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous'; // Permite trabalhar com imagens de outras origens
                img.src = base64Str;
                
                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width *= maxHeight / height;
                                height = maxHeight;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.85)); // Qualidade 85% (melhor que 70%)
                    } catch (error) {
                        console.error("Erro ao comprimir imagem:", error);
                        resolve(base64Str); // Fallback: retorna original
                    }
                };
                
                img.onerror = (error) => {
                    console.error("Erro ao carregar imagem para compress√£o:", error);
                    resolve(base64Str); // Fallback: retorna original
                };
            });
        }

        // Fun√ß√£o para Upload Direto para Cloudinary
        async function uploadToCloudinary(base64Image) {
            if (!base64Image || base64Image.startsWith('http')) return base64Image;
            
            // Verifica se as chaves foram preenchidas
            if (CLOUDINARY_URL.includes("seu_cloud_name")) {
                console.warn("‚ö†Ô∏è Cloudinary n√£o configurado. Mantendo Base64 temporariamente.");
                return base64Image;
            }

            try {
                console.log("üîÑ Comprimindo imagem...");
                // Comprime antes de subir
                const compressed = await compressImage(base64Image);
                
                console.log("üì§ Enviando para Cloudinary...");
                const formData = new FormData();
                formData.append("file", compressed);
                formData.append("upload_preset", CLOUDINARY_PRESET);

                const res = await fetch(CLOUDINARY_URL, {
                    method: "POST",
                    body: formData
                });

                if (!res.ok) {
                    const errorData = await res.json();
                    console.error("Erro do Cloudinary:", errorData);
                    throw new Error(errorData.error?.message || "Erro no upload");
                }
                
                const data = await res.json();
                console.log("‚úÖ Upload conclu√≠do:", data.secure_url);
                return data.secure_url; // Retorna o link HTTPS da imagem
            } catch (error) {
                console.error("‚ùå Erro Cloudinary:", error.message);
                console.warn("‚ö†Ô∏è Salvando como Base64 (fallback)");
                return base64Image; // Fallback para base64 se falhar
            }
        }

        // Logic Helper for Toggles
        function toggleHealthField(radio, wrapperId) {
            const wrapper = document.getElementById(wrapperId);
            if (radio.value === 'true') {
                wrapper.classList.remove('hidden');
                wrapper.classList.add('animate-fade-in');
            } else {
                wrapper.classList.add('hidden');
                const input = wrapper.querySelector('input, textarea');
                if (input) input.value = '';
            }
        }

        function toggleNoEmail(checkbox) {
            const emailInput = document.getElementById('email');
            if (checkbox.checked) {
                emailInput.value = 'naopossui@aerofestas.com.br';
                emailInput.readOnly = true;
                emailInput.classList.add('bg-slate-100', 'cursor-not-allowed', 'text-slate-400');
                emailInput.classList.remove('bg-white/50', 'text-slate-700');
                emailInput.required = false;
            } else {
                emailInput.value = '';
                emailInput.readOnly = false;
                emailInput.classList.remove('bg-slate-100', 'cursor-not-allowed', 'text-slate-400');
                emailInput.classList.add('bg-white/50', 'text-slate-700');
                emailInput.required = true;
            }
        }

        function handleEscolaridade(select) {
            const wrapper = document.getElementById('escolaridade-desc-wrapper');
            const cursoInput = document.getElementById('escolaridade_curso');
            if (select.value.includes('Superior') || select.value.includes('P√≥s')) {
                wrapper.classList.remove('hidden');
                wrapper.classList.add('animate-fade-in');
            } else {
                wrapper.classList.add('hidden');
                cursoInput.value = '';
            }
        }

        // WhatsApp Helper (Visual confirmation only)
        document.getElementById('telefone').addEventListener('input', function (e) {
            let val = e.target.value.replace(/\D/g, '');
            if (val.length > 11) val = val.slice(0, 11);

            // Basic mask
            if (val.length > 2) val = `(${val.slice(0, 2)}) ${val.slice(2)}`;
            if (val.length > 9) val = `${val.slice(0, 9)}-${val.slice(9)}`;
            e.target.value = val;
        });

        document.getElementById('contatoEmergenciaTelefone').addEventListener('input', function (e) {
            let val = e.target.value.replace(/\D/g, '');
            if (val.length > 11) val = val.slice(0, 11);
            if (val.length > 2) val = `(${val.slice(0, 2)}) ${val.slice(2)}`;
            if (val.length > 9) val = `${val.slice(0, 9)}-${val.slice(9)}`;
            e.target.value = val;
        });

        // CPF Mask
        function applyCPFMask(input) {
            input.addEventListener('input', function (e) {
                let val = e.target.value.replace(/\D/g, '');
                if (val.length > 11) val = val.slice(0, 11);
                if (val.length > 3) val = val.slice(0, 3) + '.' + val.slice(3);
                if (val.length > 7) val = val.slice(0, 7) + '.' + val.slice(7);
                if (val.length > 11) val = val.slice(0, 11) + '-' + val.slice(11);
                e.target.value = val;
            });
        }
        applyCPFMask(document.getElementById('check-cpf'));
        applyCPFMask(document.getElementById('cpf'));

        // Toggle CNH Category
        document.getElementById('cnh').addEventListener('change', function (e) {
            const wrapper = document.getElementById('cnh-categoria-wrapper');
            if (e.target.value === 'true') {
                wrapper.classList.remove('hidden');
                wrapper.classList.add('animate-fade-in');
            } else {
                wrapper.classList.add('hidden');
            }
        });

        // Idiomas Logic
        function addIdiomaRow(data = { name: '', level: 'B√°sico' }) {
            const container = document.getElementById('idiomas-container');
            const id = Date.now();
            const div = document.createElement('div');
            div.className = 'flex gap-3 animate-fade-in';
            div.id = `idioma-${id}`;
            div.innerHTML = `
                <select class="flex-1 px-4 py-3 rounded-xl border border-slate-200 bg-white outline-none focus:ring-4 focus:ring-primary-500/10">
                    <option value="Ingl√™s" ${data.name === 'Ingl√™s' ? 'selected' : ''}>Ingl√™s</option>
                    <option value="Espanhol" ${data.name === 'Espanhol' ? 'selected' : ''}>Espanhol</option>
                    <option value="Outro" ${data.name !== 'Ingl√™s' && data.name !== 'Espanhol' && data.name ? 'selected' : ''}>Outro</option>
                </select>
                <input type="text" placeholder="Qual?" class="flex-1 px-4 py-3 rounded-xl border border-slate-200 bg-white outline-none ${data.name !== 'Ingl√™s' && data.name !== 'Espanhol' && data.name ? '' : 'hidden'}" value="${data.name !== 'Ingl√™s' && data.name !== 'Espanhol' ? data.name : ''}">
                <select class="flex-1 px-4 py-3 rounded-xl border border-slate-200 bg-white outline-none">
                    <option value="B√°sico" ${data.level === 'B√°sico' ? 'selected' : ''}>B√°sico</option>
                    <option value="Intermedi√°rio" ${data.level === 'Intermedi√°rio' ? 'selected' : ''}>Intermedi√°rio</option>
                    <option value="Fluente" ${data.level === 'Fluente' ? 'selected' : ''}>Fluente</option>
                </select>
                <button type="button" onclick="document.getElementById('idioma-${id}').remove()" class="text-red-500 hover:bg-red-50 px-3 rounded-xl transition-all">
                    <i class="fa-solid fa-trash"></i>
                </button>
            `;

            const typeSelect = div.querySelector('select:first-child');
            const customInput = div.querySelector('input');
            typeSelect.onchange = () => {
                if (typeSelect.value === 'Outro') customInput.classList.remove('hidden');
                else {
                    customInput.classList.add('hidden');
                    customInput.value = '';
                }
            };

            container.appendChild(div);
        }

        // Preview and Convert to Base64
        function previewFile(input, imgId, hiddenId) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onloadend = function () {
                const img = document.getElementById(imgId);
                img.src = reader.result;
                img.classList.remove('hidden');
                document.getElementById(hiddenId).value = reader.result;
            }
            if (file) reader.readAsDataURL(file);
        }

        // L√≥gica de Identifica√ß√£o
        let monitorEncontrado = null;

        document.getElementById('btn-iniciar').addEventListener('click', async function () {
            const nome = document.getElementById('check-nome').value.trim();
            const nascimento = document.getElementById('check-nascimento').value;
            const cpfInput = document.getElementById('check-cpf');
            const cpfVerifyWrapper = document.getElementById('cpf-verify-wrapper');
            const btnText = document.getElementById('btn-iniciar-text');

            if (!nome || !nascimento) {
                alert('Informe seu nome e nascimento.');
                return;
            }

            // Se o wrapper de CPF est√° vis√≠vel, tentamos validar o CPF
            if (!cpfVerifyWrapper.classList.contains('hidden')) {
                const cpfValue = cpfInput.value.replace(/\D/g, '');
                if (cpfValue.length !== 11) {
                    alert('Informe um CPF v√°lido.');
                    return;
                }

                // Verifica se o CPF bate com o do monitor encontrado (se ele j√° tiver CPF)
                if (monitorEncontrado && monitorEncontrado.cpf) {
                    if (monitorEncontrado.cpf.replace(/\D/g, '') !== cpfValue) {
                        alert('CPF n√£o confere com o cadastro original.');
                        return;
                    }
                }

                // Se chegou aqui, CPF bate ou monitor n√£o tinha CPF. Procedemos para o formul√°rio.
                // Preenchemos o CPF no formul√°rio com o que foi usado na verifica√ß√£o
                abrirFormulario(monitorEncontrado);
                document.getElementById('cpf').value = cpfInput.value;
                return;
            }

            const btn = this;
            const originalContent = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="loader"></div> Verificando...';

            try {
                const res = await fetch(`${API_BASE}/finance/monitores/verificar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nome, nascimento })
                });

                const data = await res.json();

                if (data.found) {
                    monitorEncontrado = data.monitor;
                    // Mostra campo de CPF
                    cpfVerifyWrapper.classList.remove('hidden');
                    btnText.innerText = 'Confirmar Identidade';
                    cpfInput.focus();
                } else {
                    // Novo usu√°rio
                    document.getElementById('nome').value = nome;
                    document.getElementById('nascimento').value = nascimento;
                    abrirFormulario(null);
                }

            } catch (error) {
                alert('Erro na conex√£o. Tente novamente.');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        });

        function abrirFormulario(m) {
            if (m) {
                document.getElementById('monitor-id').value = m.id;
                document.getElementById('nome').value = m.nome;
                document.getElementById('nascimento').value = m.nascimento;
                document.getElementById('telefone').value = m.telefone || '';
                document.getElementById('cpf').value = m.cpf || '';

                if (m.email === 'naopossui@aerofestas.com.br') {
                    document.getElementById('no-email').checked = true;
                    toggleNoEmail(document.getElementById('no-email'));
                } else {
                    document.getElementById('email').value = m.email || '';
                }
                document.getElementById('endereco').value = m.endereco || '';

                // CNH
                document.getElementById('cnh').value = m.cnh ? 'true' : 'false';
                if (m.cnh) {
                    document.getElementById('cnh-categoria-wrapper').classList.remove('hidden');
                    document.getElementById('cnhCategoria').value = m.cnhCategoria || '';
                }

                // Sa√∫de Logic
                const checkField = (val, radioName, wrapperId, inputId) => {
                    if (val) {
                        document.querySelector(`input[name="${radioName}"][value="true"]`).checked = true;
                        document.getElementById(wrapperId).classList.remove('hidden');
                        document.getElementById(inputId).value = val;
                    }
                };
                checkField(m.planoSaude, 'has_plano', 'plano-wrapper', 'planoSaude');
                checkField(m.medicamentos, 'has_medicamento', 'medicamento-wrapper', 'medicamentos');
                checkField(m.restricoesAlimentares, 'has_restricao', 'restricao-wrapper', 'restricoesAlimentares');
                checkField(m.alergias, 'has_alergia', 'alergia-wrapper', 'alergias');
                checkField(m.condicaoMedica, 'has_condicao', 'condicao-wrapper', 'condicaoMedica');
                checkField(m.fobias, 'has_fobia', 'fobia-wrapper', 'fobias');

                // Escolaridade
                if (m.escolaridade) {
                    const [nivel, curso] = m.escolaridade.split(' - ');
                    document.getElementById('escolaridade').value = nivel || '';
                    if (curso) {
                        document.getElementById('escolaridade-desc-wrapper').classList.remove('hidden');
                        document.getElementById('escolaridade_curso').value = curso;
                    }
                }

                // Primeiros Socorros - PRIVACIDADE: N√£o mostrar foto existente
                if (m.possuiCursoPS) {
                    document.querySelector('input[name="possuiCursoPS"][value="true"]').checked = true;
                    document.getElementById('ps-doc-wrapper').classList.remove('hidden');
                    if (m.fotoCertificadoPS) {
                        // Apenas sinaliza que existe, n√£o carrega o bin√°rio/base64
                        const preview = document.getElementById('preview-ps');
                        preview.classList.remove('hidden');
                        preview.style.display = 'none'; // mant√©m oculto mas 'configurado' se necess√°rio
                        const btnUpload = document.querySelector('#ps-doc-wrapper .file-upload-btn span');
                        btnUpload.innerHTML = '<i class="fa-solid fa-check-double text-emerald-500"></i> Certificado j√° possui cadastro. Clique para enviar um novo, se necess√°rio.';
                    }
                }

                // Idiomas
                if (m.idiomas) {
                    try {
                        const list = JSON.parse(m.idiomas);
                        list.forEach(i => addIdiomaRow(i));
                    } catch (e) { console.error("Erro idiomas:", e); }
                }

                // Sociais & Emerg√™ncia
                document.getElementById('instagram').value = m.instagram || '';
                document.getElementById('facebook').value = m.facebook || '';
                document.getElementById('linkedin').value = m.linkedin || '';
                document.getElementById('tiktok').value = m.tiktok || '';
                document.getElementById('contatoEmergenciaParentesco').value = m.contatoEmergenciaParentesco || '';
                document.getElementById('contatoEmergenciaNome').value = m.contatoEmergenciaNome || '';
                document.getElementById('contatoEmergenciaTelefone').value = m.contatoEmergenciaTelefone || '';

                // PRIVACIDADE: N√£o mostrar foto de perfil ou documento existente
                if (m.fotoPerfil) {
                    const preview = document.getElementById('preview-perfil');
                    preview.classList.remove('hidden');
                    preview.style.display = 'none';
                    const btnLabel = document.querySelector('#fotoPerfilInput').parentElement.querySelector('span');
                    btnLabel.innerHTML = '<i class="fa-solid fa-check text-emerald-500"></i> Foto de rosto j√° cadastrada.';
                }
                if (m.fotoDocumento) {
                    const preview = document.getElementById('preview-doc');
                    preview.classList.remove('hidden');
                    preview.style.display = 'none';
                    const btnLabel = document.querySelector('#fotoDocInput').parentElement.querySelector('span');
                    btnLabel.innerHTML = '<i class="fa-solid fa-check text-emerald-500"></i> Documento j√° cadastrado.';
                }

                document.getElementById('update-badge').classList.remove('hidden');
            } else {
                addIdiomaRow(); // Primeira linha de idioma padr√£o para novos
            }

            document.getElementById('step-id').classList.add('hidden');
            document.getElementById('monitor-form').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Handle Submit
        document.getElementById('monitor-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submit-btn');
            const originalContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processando...';

            const id = document.getElementById('monitor-id').value;

            // Collect Idiomas
            const idiomasList = [];
            document.querySelectorAll('#idiomas-container > div').forEach(row => {
                const type = row.querySelector('select:first-child').value;
                const name = type === 'Outro' ? row.querySelector('input').value : type;
                const level = row.querySelector('select:last-of-type').value;
                if (name) idiomasList.push({ name, level });
            });

            // Escolaridade format: "N√≠vel - Curso"
            const escolaridadeNivel = document.getElementById('escolaridade').value;
            const escolaridadeCurso = document.getElementById('escolaridade_curso').value;
            const fullEscolaridade = escolaridadeCurso ? `${escolaridadeNivel} - ${escolaridadeCurso}` : escolaridadeNivel;

            const payload = {
                id: id || undefined,
                nome: document.getElementById('nome').value,
                nascimento: document.getElementById('nascimento').value,
                telefone: document.getElementById('telefone').value,
                email: document.getElementById('email').value,
                cpf: document.getElementById('cpf').value,
                endereco: document.getElementById('endereco').value,
                cnh: document.getElementById('cnh').value === 'true',
                cnhCategoria: document.getElementById('cnhCategoria').value,
                tamanhoCamiseta: document.getElementById('tamanhoCamiseta').value,

                tipoSanguineo: document.getElementById('tipoSanguineo').value,
                planoSaude: document.querySelector('input[name="has_plano"]:checked').value === 'true' ? document.getElementById('planoSaude').value : '',
                medicamentos: document.querySelector('input[name="has_medicamento"]:checked').value === 'true' ? document.getElementById('medicamentos').value : '',
                restricoesAlimentares: document.querySelector('input[name="has_restricao"]:checked').value === 'true' ? document.getElementById('restricoesAlimentares').value : '',
                alergias: document.querySelector('input[name="has_alergia"]:checked').value === 'true' ? document.getElementById('alergias').value : '',
                condicaoMedica: document.querySelector('input[name="has_condicao"]:checked').value === 'true' ? document.getElementById('condicaoMedica').value : '',
                fobias: document.querySelector('input[name="has_fobia"]:checked').value === 'true' ? document.getElementById('fobias').value : '',

                escolaridade: fullEscolaridade,
                possuiCursoPS: document.querySelector('input[name="possuiCursoPS"]:checked').value === 'true',
                // fotoCertificadoPS: document.getElementById('foto-ps-base64').value, // Carregado abaixo
                idiomas: JSON.stringify(idiomasList),
                habilidadesEspecificas: document.getElementById('habilidadesEspecificas').value,
                experiencias: document.getElementById('experiencias').value,

                instagram: document.getElementById('instagram').value,
                facebook: document.getElementById('facebook').value,
                linkedin: document.getElementById('linkedin').value,
                tiktok: document.getElementById('tiktok').value,

                contatoEmergenciaParentesco: document.getElementById('contatoEmergenciaParentesco').value,
                contatoEmergenciaNome: document.getElementById('contatoEmergenciaNome').value,
                contatoEmergenciaTelefone: document.getElementById('contatoEmergenciaTelefone').value,

                // fotoPerfil: document.getElementById('foto-perfil-base64').value, // Carregado abaixo
                // fotoDocumento: document.getElementById('foto-doc-base64').value, // Carregado abaixo
                observacoes: document.getElementById('observacoes').value,
                habilidades: id ? undefined : { forca: 5, agilidade: 5, proatividade: 5, comunicacao: 5, disponibilidade: 5, respeito: 5 }
            };

            // --- UPLOAD PARA CLOUDINARY ANTES DE SALVAR ---
            try {
                const fotoPS = document.getElementById('foto-ps-base64').value;
                const fotoPerfil = document.getElementById('foto-perfil-base64').value;
                const fotoDoc = document.getElementById('foto-doc-base64').value;

                if (fotoPS) payload.fotoCertificadoPS = await uploadToCloudinary(fotoPS);
                if (fotoPerfil) payload.fotoPerfil = await uploadToCloudinary(fotoPerfil);
                if (fotoDoc) payload.fotoDocumento = await uploadToCloudinary(fotoDoc);
            } catch (uploadError) {
                console.error("Erro no upload das imagens:", uploadError);
                // Continua tentando salvar mesmo se o upload falhar (opcional)
            }

            try {
                const method = id ? 'PUT' : 'POST';
                const url = id ? `${API_BASE}/finance/monitores/${id}` : `${API_BASE}/finance/monitores`;

                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    document.getElementById('monitor-form').classList.add('hidden');
                    document.getElementById('success-state').classList.remove('hidden');
                    document.getElementById('page-title').classList.add('hidden');
                    document.getElementById('page-subtitle').classList.add('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    alert('Erro ao salvar. Verifique sua conex√£o.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalContent;
                }
            } catch (e) {
                alert('Erro no servidor.');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalContent;
            }
        });
    </script>
</body>

</html>