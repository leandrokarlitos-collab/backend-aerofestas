<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico - Dados Separados</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8 bg-gray-100">
    <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">üîç Diagn√≥stico - Sistemas Separados</h1>
        
        <div id="resultado"></div>
    </div>

    <script>
        window.addEventListener('load', () => {
            const resultado = document.getElementById('resultado');
            
            try {
                // Dados da Agenda
                const agendaEvents = JSON.parse(localStorage.getItem('events') || '[]');
                const agendaToys = JSON.parse(localStorage.getItem('toys') || '[]');
                const agendaCompanies = JSON.parse(localStorage.getItem('companies') || '[]');
                
                // Dados Financeiros
                const financeData = JSON.parse(localStorage.getItem('financeDataV30') || '{}');
                const financeEventos = financeData.eventos || [];
                const financeMonitores = financeData.monitores || [];
                const financeGastos = financeData.gastos || [];
                const financeContas = financeData.contas || [];
                
                let html = '<div class="space-y-4">';
                
                // Compara√ß√£o
                html += '<div class="p-4 bg-blue-50 border-l-4 border-blue-500 rounded">';
                html += '<h2 class="font-bold text-lg mb-2">üìä Compara√ß√£o de Dados</h2>';
                html += '<div class="grid grid-cols-2 gap-4">';
                
                // Coluna 1: Agenda
                html += '<div class="bg-white p-3 rounded">';
                html += '<h3 class="font-bold mb-2 text-blue-600">üìÖ Agenda de Eventos</h3>';
                html += `<div class="text-sm space-y-1">`;
                html += `<div>Events: ${agendaEvents.length} eventos</div>`;
                html += `<div>Toys: ${agendaToys.length} brinquedos</div>`;
                html += `<div>Companies: ${agendaCompanies.length} empresas</div>`;
                html += '</div></div>';
                
                // Coluna 2: Financeiro
                html += '<div class="bg-white p-3 rounded">';
                html += '<h3 class="font-bold mb-2 text-green-600">üí∞ Gest√£o Financeira</h3>';
                html += `<div class="text-sm space-y-1">`;
                html += `<div>Eventos: ${financeEventos.length} eventos</div>`;
                html += `<div>Monitores: ${financeMonitores.length} monitores</div>`;
                html += `<div>Gastos: ${financeGastos.length} gastos</div>`;
                html += `<div>Contas: ${financeContas.length} contas</div>`;
                html += `<div>M√™s Selecionado: <strong>${financeData.selectedMonth || 'N√£o definido'}</strong></div>`;
                html += '</div></div>';
                
                html += '</div></div>';

                // An√°lise de dezembro - AGENDA
                const eventosDezembroAgenda = agendaEvents.filter(e => 
                    e.date && (e.date.startsWith('2025-12') || e.date.startsWith('2024-12'))
                );
                
                html += '<div class="p-4 bg-green-50 border-l-4 border-green-500 rounded">';
                html += '<h2 class="font-bold text-lg mb-2">üìÖ Eventos de Dezembro na AGENDA</h2>';
                if (eventosDezembroAgenda.length > 0) {
                    html += `<div class="text-sm mb-2">‚úÖ Encontrados ${eventosDezembroAgenda.length} eventos de dezembro</div>`;
                    html += '<div class="text-xs space-y-1 max-h-64 overflow-auto">';
                    eventosDezembroAgenda.forEach(e => {
                        html += `<div class="p-2 bg-white rounded">
                            <strong>${e.date}</strong>: ${e.clientName || 'Sem nome'} - ${e.price ? 'R$ ' + parseFloat(e.price).toFixed(2) : 'Sem valor'}
                        </div>`;
                    });
                    html += '</div>';
                } else {
                    html += '<div class="text-sm">‚ùå Nenhum evento de dezembro encontrado na Agenda</div>';
                }
                html += '</div>';

                // An√°lise de dezembro - FINANCEIRO
                const eventosDezembroFinance = financeEventos.filter(e => 
                    e.data && (e.data.startsWith('2025-12') || e.data.startsWith('2024-12'))
                );
                
                html += '<div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">';
                html += '<h2 class="font-bold text-lg mb-2">üí∞ Eventos de Dezembro no FINANCEIRO</h2>';
                if (eventosDezembroFinance.length > 0) {
                    html += `<div class="text-sm mb-2">‚úÖ Encontrados ${eventosDezembroFinance.length} eventos de dezembro</div>`;
                    html += '<div class="text-xs space-y-1 max-h-64 overflow-auto">';
                    eventosDezembroFinance.forEach(e => {
                        html += `<div class="p-2 bg-white rounded">
                            <strong>${e.data}</strong>: ${e.descricao || 'Sem descri√ß√£o'} - R$ ${parseFloat(e.valor || 0).toFixed(2)}
                        </div>`;
                    });
                    html += '</div>';
                } else {
                    html += '<div class="text-sm">‚ùå Nenhum evento de dezembro encontrado no sistema Financeiro</div>';
                }
                html += '</div>';

                // Solu√ß√£o
                html += '<div class="p-4 bg-purple-50 border-l-4 border-purple-500 rounded">';
                html += '<h2 class="font-bold text-lg mb-2">üí° Diagn√≥stico e Solu√ß√£o</h2>';
                
                if (eventosDezembroAgenda.length > 0 && eventosDezembroFinance.length === 0) {
                    html += '<div class="text-sm space-y-2">';
                    html += '<p class="font-bold text-purple-800">Problema identificado:</p>';
                    html += '<p>Os eventos de dezembro existem na <strong>Agenda</strong>, mas n√£o no sistema <strong>Financeiro</strong>.</p>';
                    html += '<p class="mt-3 font-bold text-purple-800">Causa:</p>';
                    html += '<p>S√£o sistemas com dados separados. Os dados do <code class="bg-gray-200 px-1 rounded">financeDataV30</code> n√£o foram exportados do arquivo example.</p>';
                    html += '<p class="mt-3 font-bold text-purple-800">Solu√ß√£o:</p>';
                    html += '<ol class="list-decimal list-inside ml-4 space-y-1">';
                    html += '<li>Abra o arquivo <code class="bg-gray-200 px-1 rounded">example/Sistema Gest√£o Financeira.html</code> (n√£o a Agenda)</li>';
                    html += '<li>Use a ferramenta de exporta√ß√£o nesse arquivo</li>';
                    html += '<li>Reimporte os dados financeiros</li>';
                    html += '</ol>';
                    html += '</div>';
                } else if (eventosDezembroFinance.length > 0) {
                    html += '<div class="text-sm">';
                    html += '<p class="font-bold text-green-600 mb-2">‚úÖ Os dados de dezembro existem no sistema Financeiro!</p>';
                    html += '<p>O problema pode ser:</p>';
                    html += '<ul class="list-disc list-inside ml-4">';
                    html += `<li>O m√™s selecionado n√£o √© dezembro (Atual: <strong>${financeData.selectedMonth}</strong>)</li>`;
                    html += '<li>Use o seletor de m√™s no topo da p√°gina para escolher Dezembro</li>';
                    html += '</ul>';
                    html += '<button onclick="definirDezembro()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold">Definir M√™s para Dezembro/2025</button>';
                    html += '</div>';
                } else {
                    html += '<div class="text-sm">';
                    html += '<p class="font-bold text-yellow-600 mb-2">‚ö†Ô∏è Nenhum dado de dezembro encontrado em nenhum sistema</p>';
                    html += '<p>Os dados podem estar em outro m√™s ou n√£o foram salvos.</p>';
                    html += '</div>';
                }
                
                html += '</div>';

                html += '</div>';
                resultado.innerHTML = html;
                
            } catch (error) {
                resultado.innerHTML = `<div class="p-4 bg-red-50 border-l-4 border-red-500 rounded">
                    <h3 class="font-bold text-red-800 mb-2">‚ùå Erro ao analisar dados</h3>
                    <div class="text-sm">${error.message}</div>
                    <pre class="mt-2 text-xs bg-white p-2 rounded overflow-auto">${error.stack}</pre>
                </div>`;
            }
        });

        function definirDezembro() {
            try {
                const financeData = JSON.parse(localStorage.getItem('financeDataV30') || '{}');
                financeData.selectedMonth = '2025-12';
                localStorage.setItem('financeDataV30', JSON.stringify(financeData));
                alert('‚úÖ M√™s definido para Dezembro/2025!\n\nAcesse: Sistema Gest√£o Financeira.html');
                window.open('/Sistema Gest√£o Financeira.html', '_blank');
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            }
        }
    </script>
</body>
</html>

