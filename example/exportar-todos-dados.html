<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exportar TODOS os Dados</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8 bg-gray-100">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">ğŸ“¤ Exportar TODOS os Dados (Incluindo Financeiro)</h1>
        
        <div class="mb-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
            <h2 class="font-bold mb-2">ğŸ“ InstruÃ§Ãµes:</h2>
            <ol class="list-decimal list-inside space-y-2 text-sm">
                <li>Abra este arquivo a partir da pasta <code class="bg-gray-200 px-2 py-1 rounded">example/</code></li>
                <li>Clique em "Exportar TODOS os Dados"</li>
                <li>O arquivo JSON serÃ¡ baixado automaticamente</li>
                <li>Use-o na ferramenta de importaÃ§Ã£o: <code class="bg-gray-200 px-2 py-1 rounded">http://localhost:3000/migrar-dados.html</code></li>
            </ol>
        </div>

        <div id="status" class="mb-6"></div>

        <button onclick="exportarTodosDados()" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-lg font-bold text-lg">
            ğŸ“¤ Exportar TODOS os Dados
        </button>
    </div>

    <script>
        function exportarTodosDados() {
            const statusEl = document.getElementById('status');
            
            try {
                // Coletar TODOS os dados possÃ­veis
                const dados = {
                    // Agenda de Eventos
                    toys: JSON.parse(localStorage.getItem('toys') || '[]'),
                    companies: JSON.parse(localStorage.getItem('companies') || '[]'),
                    events: JSON.parse(localStorage.getItem('events') || '[]'),
                    clients: JSON.parse(localStorage.getItem('clients') || '[]'),
                    // CRM
                    crmToyClients_v8: JSON.parse(localStorage.getItem('crmToyClients_v8') || '[]'),
                    // GestÃ£o Financeira - todas as versÃµes
                    financeDataV30: localStorage.getItem('financeDataV30') ? JSON.parse(localStorage.getItem('financeDataV30')) : null,
                    financeDataV29: localStorage.getItem('financeDataV29') ? JSON.parse(localStorage.getItem('financeDataV29')) : null,
                    financeDataV22: localStorage.getItem('financeDataV22') ? JSON.parse(localStorage.getItem('financeDataV22')) : null,
                    financeDataV23: localStorage.getItem('financeDataV23') ? JSON.parse(localStorage.getItem('financeDataV23')) : null,
                    financeDataV21: localStorage.getItem('financeDataV21') ? JSON.parse(localStorage.getItem('financeDataV21')) : null,
                    // Dashboard
                    dailyPlanHistory_v1: localStorage.getItem('dailyPlanHistory_v1') ? JSON.parse(localStorage.getItem('dailyPlanHistory_v1')) : null,
                    // ConfiguraÃ§Ãµes
                    geminiApiKey: localStorage.getItem('geminiApiKey') || null
                };

                // Contar itens
                const total = 
                    dados.toys.length + 
                    dados.companies.length + 
                    dados.events.length + 
                    dados.clients.length + 
                    dados.crmToyClients_v8.length;

                const hasFinanceData = dados.financeDataV30 || dados.financeDataV29 || dados.financeDataV22 || dados.financeDataV23 || dados.financeDataV21;
                const hasDailyPlans = dados.dailyPlanHistory_v1 && Object.keys(dados.dailyPlanHistory_v1).length > 0;

                if (total === 0 && !hasFinanceData) {
                    statusEl.innerHTML = `<div class="p-4 bg-red-50 border-l-4 border-red-500 rounded">
                        <h3 class="font-bold text-red-800 mb-2">âš ï¸ Nenhum dado encontrado!</h3>
                        <div class="text-sm">Certifique-se de abrir este arquivo a partir da pasta <code>example/</code> onde os dados estÃ£o armazenados.</div>
                    </div>`;
                    return;
                }

                // Criar arquivo JSON
                const json = JSON.stringify(dados, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Criar link de download
                const a = document.createElement('a');
                a.href = url;
                a.download = `dados-completos-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                // Limpar
                URL.revokeObjectURL(url);

                // Qual versÃ£o financeira foi encontrada
                let versaoFinanceira = 'Nenhuma';
                if (dados.financeDataV30) versaoFinanceira = 'V30 (mais recente)';
                else if (dados.financeDataV29) versaoFinanceira = 'V29';
                else if (dados.financeDataV22) versaoFinanceira = 'V22';
                else if (dados.financeDataV23) versaoFinanceira = 'V23';
                else if (dados.financeDataV21) versaoFinanceira = 'V21';

                statusEl.innerHTML = `<div class="p-4 bg-green-50 border-l-4 border-green-500 rounded">
                    <h3 class="font-bold text-green-800 mb-2">âœ… Dados exportados com sucesso!</h3>
                    <div class="text-sm space-y-1">
                        <div><strong>Agenda de Eventos:</strong></div>
                        <div class="ml-4">ğŸ“¦ Toys: ${dados.toys.length} itens</div>
                        <div class="ml-4">ğŸ¢ Companies: ${dados.companies.length} itens</div>
                        <div class="ml-4">ğŸ“… Events: ${dados.events.length} itens</div>
                        <div class="ml-4">ğŸ‘¥ Clients: ${dados.clients.length} itens</div>
                        <div class="mt-2"><strong>CRM:</strong></div>
                        <div class="ml-4">ğŸ“Š CRM Clients: ${dados.crmToyClients_v8.length} itens</div>
                        <div class="mt-2"><strong>GestÃ£o Financeira:</strong></div>
                        <div class="ml-4">ğŸ’° Dados Financeiros: ${hasFinanceData ? `âœ… ${versaoFinanceira}` : 'âŒ NÃ£o encontrado'}</div>
                        <div class="mt-2"><strong>Dashboard:</strong></div>
                        <div class="ml-4">ğŸ“‹ Planos DiÃ¡rios: ${hasDailyPlans ? `âœ… ${Object.keys(dados.dailyPlanHistory_v1).length} planos` : 'âŒ NÃ£o encontrado'}</div>
                        <div class="mt-2"><strong>ConfiguraÃ§Ãµes:</strong></div>
                        <div class="ml-4">ğŸ”‘ Gemini API Key: ${dados.geminiApiKey ? 'âœ… IncluÃ­da' : 'âŒ NÃ£o encontrada'}</div>
                        <div class="mt-3 pt-3 border-t border-green-200 font-bold">Total de itens: ${total}</div>
                    </div>
                    <div class="mt-4 text-sm">
                        <strong>Arquivo salvo:</strong> <code class="bg-gray-200 px-2 py-1 rounded">${a.download}</code>
                    </div>
                    <div class="mt-4 p-3 bg-blue-50 rounded">
                        <p class="text-sm font-bold mb-2">PrÃ³ximo passo:</p>
                        <ol class="list-decimal list-inside text-sm">
                            <li>Acesse: <code class="bg-gray-200 px-2 py-1 rounded">http://localhost:3000/migrar-dados.html</code></li>
                            <li>Carregue o arquivo <code class="bg-gray-200 px-2 py-1 rounded">${a.download}</code></li>
                            <li>Clique em "Importar Dados"</li>
                        </ol>
                    </div>
                </div>`;

            } catch (error) {
                statusEl.innerHTML = `<div class="p-4 bg-red-50 border-l-4 border-red-500 rounded">
                    <h3 class="font-bold text-red-800 mb-2">âŒ Erro ao exportar</h3>
                    <div class="text-sm">${error.message}</div>
                    <pre class="mt-2 text-xs bg-white p-2 rounded overflow-auto">${error.stack}</pre>
                </div>`;
            }
        }

        // Verificar dados ao carregar
        window.addEventListener('load', () => {
            const statusEl = document.getElementById('status');
            
            try {
                const dados = {
                    toys: JSON.parse(localStorage.getItem('toys') || '[]'),
                    companies: JSON.parse(localStorage.getItem('companies') || '[]'),
                    events: JSON.parse(localStorage.getItem('events') || '[]'),
                    clients: JSON.parse(localStorage.getItem('clients') || '[]'),
                    crmToyClients_v8: JSON.parse(localStorage.getItem('crmToyClients_v8') || '[]')
                };

                const financeV30 = localStorage.getItem('financeDataV30');
                const financeV29 = localStorage.getItem('financeDataV29');
                const financeV22 = localStorage.getItem('financeDataV22');
                const financeV23 = localStorage.getItem('financeDataV23');
                const financeV21 = localStorage.getItem('financeDataV21');
                const hasFinanceData = financeV30 || financeV29 || financeV22 || financeV23 || financeV21;

                const total = dados.toys.length + dados.companies.length + dados.events.length + dados.clients.length + dados.crmToyClients_v8.length;

                let versaoFinanceira = 'Nenhuma';
                if (financeV30) versaoFinanceira = 'V30 (mais recente)';
                else if (financeV29) versaoFinanceira = 'V29';
                else if (financeV22) versaoFinanceira = 'V22';
                else if (financeV23) versaoFinanceira = 'V23';
                else if (financeV21) versaoFinanceira = 'V21';

                if (total > 0 || hasFinanceData) {
                    statusEl.innerHTML = `<div class="p-4 bg-green-50 border-l-4 border-green-500 rounded">
                        <h3 class="font-bold text-green-800 mb-2">âœ… Dados encontrados e prontos para exportar!</h3>
                        <div class="text-sm space-y-1">
                            <div>ğŸ“¦ Toys: ${dados.toys.length} itens</div>
                            <div>ğŸ¢ Companies: ${dados.companies.length} itens</div>
                            <div>ğŸ“… Events: ${dados.events.length} itens</div>
                            <div>ğŸ‘¥ Clients: ${dados.clients.length} itens</div>
                            <div>ğŸ“Š CRM Clients: ${dados.crmToyClients_v8.length} itens</div>
                            <div>ğŸ’° Dados Financeiros: ${hasFinanceData ? `âœ… ${versaoFinanceira}` : 'âŒ NÃ£o encontrado'}</div>
                            <div class="mt-2 pt-2 border-t border-green-200 font-bold">Total: ${total} itens</div>
                        </div>
                    </div>`;
                } else {
                    statusEl.innerHTML = `<div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                        <h3 class="font-bold text-yellow-800 mb-2">âš ï¸ Nenhum dado encontrado</h3>
                        <div class="text-sm">Certifique-se de abrir este arquivo a partir da pasta <code>example/</code>.</div>
                    </div>`;
                }
            } catch (error) {
                statusEl.innerHTML = `<div class="p-4 bg-red-50 border-l-4 border-red-500 rounded">
                    <h3 class="font-bold text-red-800 mb-2">âŒ Erro ao verificar dados</h3>
                    <div class="text-sm">${error.message}</div>
                </div>`;
            }
        });
    </script>
</body>
</html>

